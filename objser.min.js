/*!
 * objser.js
 * Copyright (c) 2015 Greg Omelaenko
 * License: https://github.com/ObjSer/objser-js/blob/master/LICENSE
 */
"use strict";var objser=new function(){function e(e,r){function t(e){if(e&&e.hasOwnProperty("__objser_id"))return e.__objser_id;var r=L++;J[r]=e;var n=typeof e;switch(n){case"number":K[r]=i(S,e);break;case"boolean":K[r]=i(U,e);break;case"string":K[r]=i(M,e);break;case"object":if(null===e){K[r]=F;break}if(e.__objser_id=r,Array.isArray(e)){for(var a=[],s=0;s<e.length;++s)a[s]=t(e[s]);K[r]=i(q,a)}else{var a=[],s=0;for(var o in e)"__objser_id"!==o&&(a[s++]=t(o),a[s++]=t(e[o]));K[r]=i(G,a)}break;default:throw"Unrecognised type '"+n+"'."}return r}function c(){for(var e=0;e<arguments.length;++e)r[I++]=arguments[e]}function i(e,r){return function(){e(r)}}function w(e){c(e)}function y(e){c(255&e,e>>8)}function k(e){c(255&e,e>>8&255,e>>16&255,e>>>24)}function P(e){var r=Math.floor(e/4294967296),n=4294967295&e;c(255&n,n>>8&255,n>>16&255,n>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255)}function S(e){if(e%1!==0)throw"Floats are not supported.";if(e>=-32&&0>e)c(e+256);else if(e>=0&&63>=e)c(u|e);else{var r=0>e;e>=-128&&255>=e?(c(r?_:d),w(e)):e>=-32768&&65535>=e?(c(r?h:m),y(e)):e>=-2147483648&&4294967295>=e?(c(r?b:p),k(e)):(c(r?g:j),P(e))}}function U(e){c(e?l:f)}function F(){c(v)}function M(e){if(0==e.length)c(O);else{c(A);for(var n=I,t=0;t<e.length;++t){var a=e.charCodeAt(t);128>a?c(a):2048>a?c(a>>6|192,63&a|128):c(a>>12|224,a>>6&63|128,63&a|128)}var s=I-n;15>=s?r[n-1]=C|s:r[I++]=0}}function q(e){if(0==e.length)r[I++]=z;else{var n=e.length>31;r[I++]=n?x:R|e.length;for(var t=0;t<e.length;++t)H(e[t]);I=r.length,n&&(r[I++]=E)}}function G(e){e.length?(r[I++]=B,q(e)):r[I++]=D}function H(e){var t=L-e-1;if(63>=t)r[I++]=n|t;else if(255>=t)r[I++]=a,w(t);else if(65535>=t)r[I++]=s,y(t);else{if(!(4294967295>=t))return print("rip");r[I++]=o,k(t)}}var I=r.length,J=[],K=[],L=0;t(e);for(var N=L;N-- >0;)K[N](),J[N]&&J[N].hasOwnProperty("__objser_id")&&delete J[N].__objser_id;return r}function r(e,r){function n(e){this.resolve=function(){return R[e]}}function u(){function C(n){var t=e[r++];return n&&t>127&&(t-=256),t}function R(n){var t=e[r++]|e[r++]<<8;return n&&t>32767&&(t-=65536),t}function H(n){var t=(e[r++]|e[r++]<<8|e[r++]<<16)+16777216*e[r++];return n&&t>2147483647&&(t-=4294967296),t}function I(n){var t=(e[r++]|e[r++]<<8|e[r++]<<16)+16777216*e[r++],a=(e[r++]|e[r++]<<8|e[r++]<<16)+16777216*e[r++];n&&a>2147483647&&(a-=4294967296);var s=t+4294967296*a;return s}function J(n){for(var t="",a=r+n;a>r;){var s=e[r++];if(128>s)t+=String.fromCharCode(s);else if(s>191&&224>s){var o=e[r++];t+=String.fromCharCode((31&s)<<6|63&o)}else{var o=e[r++],u=e[r++];t+=String.fromCharCode((15&s)<<12|(63&o)<<6|63&u)}}return t}var K=e[r++],L=K;K>=0&&63>=K?L=t:K>=128&&191>=K?(L=c,K&=63):K>=224&&255>=K?L=i:K>=113&&127>=K?(L=k,K&=15):K>=97&&111>=K?(L=P,K&=15):K>=65&&95>=K?(L=q,K&=31):K>=216&&223>=K&&(L=G);switch(L){case t:return new n(K);case a:return new n(C(!1));case s:return new n(R(!1));case o:return new n(H(!1));case c:return 127&K;case i:return K-256;case f:return!1;case l:return!0;case v:return null;case _:return C(!0);case d:return C(!1);case h:return R(!0);case m:return R(!1);case b:return H(!0);case p:return H(!1);case g:return I(!0);case j:return I(!1);case w:case y:case k:return J(K);case A:for(var N,Q=r;Q<e.length;++Q)if(!e[Q]){N=Q-r;break}var T=J(N);return++r,T;case O:return"";case P:case S:case U:case F:case M:case q:for(var N=K,V=[],Q=0;N>Q;++Q)V[Q]=u();return V;case x:for(var V=[],Q=0,W=u();void 0!==W;++Q,W=u())V[Q]=W;case z:return[];case B:var V=u();return{__objser_map_elements:V};case D:return{__objser_map_elements:[]};case E:return;case G:throw"Reserved byte value "+K+" used.";default:throw"Unrecognised byte value "+K+"."}}function C(e){for(;e instanceof n;)e=e.resolve();var r=typeof e;if(Array.isArray(e))for(var t=0;t<e.length;++t)e[t]=C(e[t]);else if("object"===r&&e&&e.hasOwnProperty("__objser_map_elements")){var a=e.__objser_map_elements;delete e.__objser_map_elements;for(var t=0;t<a.length;t+=2)e[C(a[t])]=C(a[t+1])}return e}for(var R=[],H=0;r<e.length;++H)R[H]=u();var I=R[R.length-1];return C(I)}var n=0,t=0,a=64,s=96,o=112,u=128,c=128,i=224,f=192,l=193,v=194,_=195,h=196,b=197,g=198,d=199,m=200,p=201,j=202,w=203,y=204,C=112,k=113,A=205,O=206,P=97,S=208,U=209,F=210,M=211,R=64,q=65,x=212,z=213,B=214,D=215,E=207,G=216;this.serialise=function(r){return e(r,[])},this.deserialise=function(e){return r(e,0)}};