/*!
 * objser.js
 * Copyright (c) 2015 Greg Omelaenko
 * License: https://github.com/ObjSer/objser-js/blob/master/LICENSE
 */
"use strict";var objser=new function(){function r(r,e){function t(r){if(r&&r.hasOwnProperty("__objser_id"))return r.__objser_id;var e=Q++;K[e]=r;switch(typeof r){case"number":L[e]=c(P,r);break;case"boolean":L[e]=c(J,r);break;case"string":L[e]=c(N,r);break;case"object":if(null===r){L[e]=M;break}if(r.__objser_id=e,Array.isArray(r)){for(var n=[],a=0;a<r.length;++a)n[a]=t(r[a]);L[e]=c(x,n)}else{var n=[],a=0;for(var s in r)"__objser_id"!==s&&(n[a++]=t(s),n[a++]=t(r[s]));L[e]=c(G,n)}break;default:L[e]=function(){print("who knows "+JSON.stringify(r))}}return e}function u(){for(var r=0;r<arguments.length;++r)e[I++]=arguments[r]}function c(r,e){return function(){r(e)}}function w(r){u(r)}function y(r){u(255&r,r>>8)}function C(r){u(255&r,r>>8&255,r>>16&255,r>>>24)}function S(r){var e=Math.floor(r/4294967296),n=4294967295&r;u(255&n,n>>8&255,n>>16&255,n>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255)}function P(r){if(r%1===0)if(r>=-32&&0>r)u(r+256);else if(r>=0&&63>=r)u(i|r);else{var e=0>r;r>=-128&&255>=r?(u(e?_:m),w(r)):r>=-32768&&65535>=r?(u(e?h:d),y(r)):r>=-2147483648&&4294967295>=r?(u(e?g:j),C(r)):(u(e?b:p),S(r))}}function J(r){u(r?l:f)}function M(){u(v)}function N(r){if(0==r.length)u(O);else{u(A);for(var n=I,t=0;t<r.length;++t){var a=r.charCodeAt(t);128>a?u(a):2048>a?u(a>>6|192,63&a|128):u(a>>12|224,a>>6&63|128,63&a|128)}var s=I-n;15>=s?e[n-1]=k|s:e[I++]=0}}function x(r){if(0==r.length)e[I++]=B;else{var n=r.length>31;e[I++]=n?z:q|r.length;for(var t=0;t<r.length;++t)H(r[t]);I=e.length,n&&(e[I++]=F)}}function G(r){r.length?(e[I++]=D,x(r)):e[I++]=E}function H(r){var t=Q-r-1;if(63>=t)e[I++]=n|t;else if(255>=t)e[I++]=a,w(t);else if(65535>=t)e[I++]=s,y(t);else{if(!(4294967295>=t))return print("rip");e[I++]=o,C(t)}}var I=e.length,K=[],L=[],Q=0;t(r);for(var R=Q;R-- >0;)L[R](),K[R]&&K[R].hasOwnProperty("__objser_id")&&delete K[R].__objser_id;return e}function e(r,e){function n(r){this.resolve=function(){return q[r]}}function i(){function k(n){var t=r[e++];return n&&t>127&&(t-=256),t}function q(n){var t=r[e++]|r[e++]<<8;return n&&t>32767&&(t-=65536),t}function H(n){var t=(r[e++]|r[e++]<<8|r[e++]<<16)+16777216*r[e++];return n&&t>2147483647&&(t-=4294967296),t}function I(n){var t=(r[e++]|r[e++]<<8|r[e++]<<16)+16777216*r[e++],a=(r[e++]|r[e++]<<8|r[e++]<<16)+16777216*r[e++];n&&a>2147483647&&(a-=4294967296);var s=t+4294967296*a;return s}function K(n){for(var t="",a=e+n;a>e;){var s=r[e++];if(128>s)t+=String.fromCharCode(s);else if(s>191&&224>s){var o=r[e++];t+=String.fromCharCode((31&s)<<6|63&o)}else{var o=r[e++],i=r[e++];t+=String.fromCharCode((15&s)<<12|(63&o)<<6|63&i)}}return t}var L=r[e++],Q=L;L>=0&&63>=L?Q=t:L>=128&&191>=L?(Q=u,L&=63):L>=224&&255>=L?Q=c:L>=113&&127>=L?(Q=C,L&=15):L>=97&&111>=L?(Q=S,L&=15):L>=65&&95>=L?(Q=x,L&=31):L>=216&&223>=L&&(Q=G);switch(Q){case t:return new n(L);case a:return new n(k(!1));case s:return new n(q(!1));case o:return new n(H(!1));case u:return 127&L;case c:return L-256;case f:return!1;case l:return!0;case v:return null;case _:return k(!0);case m:return k(!1);case h:return q(!0);case d:return q(!1);case g:return H(!0);case j:return H(!1);case b:return I(!0);case p:return I(!1);case w:case y:case C:return K(L);case A:for(var R,T=e;T<r.length;++T)if(!r[T]){R=T-e;break}var U=K(R);return++e,U;case O:return"";case S:case P:case J:case M:case N:case x:for(var R=L,V=[],T=0;R>T;++T)V[T]=i();return V;case z:for(var V=[],T=0,W=i();void 0!==W;++T,W=i())V[T]=W;case B:return[];case D:var V=i();return{__objser_map_elements:V};case E:return{__objser_map_elements:[]};case F:return;case G:}}function k(r){for(;r instanceof n;)r=r.resolve();var e=typeof r;if(Array.isArray(r))for(var t=0;t<r.length;++t)r[t]=k(r[t]);else if("object"===e&&r&&r.hasOwnProperty("__objser_map_elements")){var a=r.__objser_map_elements;delete r.__objser_map_elements;for(var t=0;t<a.length;t+=2)r[k(a[t])]=k(a[t+1])}return r}for(var q=[],H=0;e<r.length;++H)q[H]=i();var I=q[q.length-1];return k(I)}var n=0,t=0,a=64,s=96,o=112,i=128,u=128,c=224,f=192,l=193,v=194,_=195,h=196,g=197,b=198,m=199,d=200,j=201,p=202,w=203,y=204,k=112,C=113,A=205,O=206,S=97,P=208,J=209,M=210,N=211,q=64,x=65,z=212,B=213,D=214,E=215,F=207,G=216;this.serialise=function(e){return r(e,[])},this.deserialise=function(r){return e(r,0)}};